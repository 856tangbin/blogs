---
title: Text and Typography
description: Examples of text, typography, math equations, diagrams, flowcharts, pictures, videos, and more.
author: cotes
date: 2019-08-08 11:33:00 +0800
categories: [Blogging, Demo]
tags: [typography]
pin: true
math: true
mermaid: true
---



# 加权线性回归

这是一篇自我疑惑解答的博客，我写完整理后希望也可以帮到和我有一样疑惑的人，这篇博客包含的内容简要：

- 加权线性回归是什么、它与线性回归的差别，以及参数求解；
- 加权线性回归应该如何有效地加权？如何确保权重的正确性？
  - 列举了两个需要加权的数值例子；
  - 探讨如何有效加权；
- 总结：确保满足同分布特性实现有效加权（针对R包中的 `lm()`）



## 1 加权线性回归与普通线性回归

### 普通线性回归

对于 $N$ 个观测数据

$$
(X_i,y_i), i=1,2,3,\cdots,N
$$

可以使用线性回归模型

$$
y = \beta X + \theta + \epsilon
$$

来拟合 $X$ 和 $y$ 之间的关系。其中的参数 $\beta,\theta$ 通常使用最小二乘拟合，即按照使代价函数

$$
J(\beta,\theta) = \frac{1}{N} \sum_{i=1}^N (y_i - \beta X_i - \theta)^2
$$

最小的 $\hat \beta,\hat \theta$，使得拟合曲线尽可能地接近所有的观测点。



### 3.2 随机分布的因变量和自变量

**场景：**上个例子我们假设所有（自变量和因变量）数据都是来自独立同分布的正态分布，但实际由于数据来源不同，观测数据可能服从不同的正态分布，假设有 $N$ 个观测数据 $(x_i,y_i)$，每个观察数据都来自于不同的正态分布，即 $x_i \sim N(\overline x_i,\sigma^2_{xi}),y_i \sim N(\overline y_i,\sigma^2_{yi}),i =1,2,\cdots,N$。

这里我同样模拟了三种线性模型进行估计，包括一般线性回归1、 加权线性回归2( $|\sigma_{yi}|^{-1}$ ) 和加权线性回归3( $1/\sigma_{yi}^2$ )。我简单地列举了它们的相关参数以及统计推断的结果 (代码见下方)。
$$
123123123123
$$

这里模拟的是20个样本量，200个样本量似乎样本量足够，不同模型没有区别。

```R
set.seed(0)
Data1 = data.frame(theta = seq(1000),beta = seq(1000),P_beta=seq(1000))
Data2 =data.frame(theta = seq(1000),beta = seq(1000),P_beta=seq(1000))
Data3 = data.frame(theta = seq(1000),beta = seq(1000),P_beta=seq(1000))

N = 20 # 200
for(i in seq(1000)){
    gamma = 0
    X_mean = rnorm(N)
    sd_X = rchisq(N,1) + 0.1
    X = rnorm(N,X_mean,sd_X)
    
    mean_Y = gamma * X_mean
    sd_Y = rchisq(N,1) + 0.1
    Y = mean_Y + rnorm(N,0,sd_Y)
    
    model1 = summary(lm(Y~X))
    model2 = summary(lm(Y~X,weights = abs(sd_Y)^-1))   
    model3 = summary(lm(Y~X,weights = sd_Y^-2))   
    
    Data1[i,] = c(model1$coefficients[,"Estimate"],model1$coefficients["X","Pr(>|t|)"])
    Data2[i,] = c(model2$coefficients[,"Estimate"],model2$coefficients["X","Pr(>|t|)"])
    Data3[i,] = c(model3$coefficients[,"Estimate"],model3$coefficients["X","Pr(>|t|)"])
}

boxplot(Data1$beta,Data2$beta,Data3$beta)
boxplot(Data1$theta,Data2$theta,Data3$theta)

Expected = sort(-log10(seq(1000)/1000))
plot(c(Expected,Expected,Expected),
     c(sort(-log10(Data1$P_beta)),sort(-log10(Data2$P_beta)),sort(-log10(Data3$P_beta))),
     col = c(rep("red",1000),rep("blue",1000),rep("black",1000)),
     pch=10)
legend("topleft", # 图例位置
       legend = c("model1", "model2", "model3"), # 图例名称
       col = c("blue", "red","black"), # 颜色
       pch = c(10, 10,10), # 点样式
       lty = c(1, 1)) # 线型
abline(b=1,a=0)

```

